<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Registrar Grupo</title>
</head>

<body>
	
	<!-- <header th:replace="layout/layout :: header"></header> -->
	
	<br>
	
	<div class="container">
	   <div class="row">
	      <div class="col-lg-6 col-md-6 col-sm-6 container justify-content-center card">
	           <!-- <h1 class="text-center" th:text="${titulo}"></h1> -->
               <h1 class="text-center" th:text="${title}"></h1>
	           <div class="card-body">
	              <form 
                    th:object="${grupo}" 
                    method="post" 
                    th:action="${formType == 'post' ? '/grupo/registrar' : '/grupo/actualizar'}"
                    th:if="${formType == 'post' || formType == 'put'}"
                    >

                    <!--OJO  -->
                    <input type="hidden" th:field="*{idGrupo}" th:value="${grupo.idGrupo}"/>
                    
                    <!--OJO-->
                    <div class="form-group">
                        <label>Nombre de Grupo : </label>
                        <input type="text" th:field="*{descripcion}" class="form-control" th:errorclass="'form-control alert-danger"/>
                        <!-- <small class="form-text text-danger" th:if="${#fields.hasErrors('grupo.descripcion')}" th:errors="*{grupo.descripcion}"></small> -->
                    </div>
                    
                    <div class="box-footer"> 
                        <input type="submit" value="Guardar" class="btn btn-primary">
                    </div>

	              </form>

                  <form 
                    th:object="${grupoPersonaDto}" 
                    method="post" 
                    th:action="@{/grupo/newMember}"
                    th:if="${formType == 'new'}"
                    >
                    <input type="hidden" th:field="*{idGrupo}">
                    <div class="form-group d-flex flex-row align-items-baseline justify-content-center">
                        <label>Nombre de Grupo: </label>
                        <h4 class="px-2" th:text="*{descripcion}"></h4>
                    </div>

                    <div class="form-group">
                        <label>Nuevo miembro </label>
                        <div class="input-group">
                            <select name="cboPersonas" id="idPersona" class="form-select form-control" th:field="*{idPersona}">
                                <option value="-1">[Seleccione Miembro]</option>
                                <option 
                                    th:each="item : ${cboPersonas}"
                                    th:value="${item.idPersona}"
						            th:utext="${item.nombres + ' ' + item.apellidos}"></option>
                            </select>
                        </div>
                    </div>

                    <div class="box-footer"> 
                        <input type="submit" value="Agregar miembro" class="btn btn-primary">
                    </div>

                  </form>
	           </div>
	      </div>
	   </div>

       <div class="row">
            <div class="card-body" th:if="${formType == 'new'}">
                <h4 class="card-title d-flex flex-column align-items-end">
                    <a th:href="@{/grupo/}" class="btn btn-warning">Regresar al listado de grupos</a>
                </h4>

                <table class="table table-striped">
                    <thead class="text-center">
                        <tr>
                            <th>ID</th>
                            <th>Nombres</th>
                            <th>Email</th>
                            <th>Detalle de prestamista</th>
                            <th>Eliminar Miembro</th>
                        </tr>
                    </thead>

                    <tbody class="text-center">
                        <tr th:each="item : ${tblPersonas}" >
                            <td th:text="${item.idPersona}" ></td>
                            <td th:text="${item.nombres + ' ' + item.apellidos}" ></td>
                            <td th:text="${item.email}"></td>
                            <td>
                                <a
                                    class="btn btn-primary btn-sm"
                                    th:href="@{/grupo/} + ${item.idGrupo} + '/newMember'">
                                    Detalles del prestamista
                                </a>
                            </td>
                            <td>
                                <a
                                    class="btn btn-danger btn-sm"
                                    th:href="@{/grupo/} + ${item.idGrupo} + '/deleteMember/' + ${item.idPersona}"
                                    onclick="return confirm('¿Estás seguro de eliminar a este prestamista del grupo?');">
                                    Eliminar
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
       </div>
	</div>
	
	<footer>
        
    </footer>
		
</body>
</html>